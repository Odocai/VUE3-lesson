{
  "version": 3,
  "sources": ["../src/effect.ts", "../../shared/src/index.ts", "../src/baseHandler.ts", "../src/reactive.ts"],
  "sourcesContent": ["export function effect(fn,options?){\n    // \u521B\u5EFA\u4E00\u4E2A\u54CD\u5E94\u5F0Feffect \u6570\u636E\u53D8\u5316\u540E\u53EF\u4EE5\u91CD\u65B0\u6267\u884C\n\n    // \u521B\u5EFA\u4E00\u4E2Aeffect\uFF0C\u53EA\u8981\u4F9D\u8D56\u7684\u5C5E\u6027\u53D8\u5316\u4E86\u5C31\u8981\u6267\u884C\u56DE\u8C03\n    const _effect = new ReactiveEffect(fn,()=>{\n        // scheduler\n        _effect.run();\n    })\n    _effect.run();\n}\n\nexport let activeEffect; //undefined -> f1 -> f2 -> f1 -> undefined\n\nclass ReactiveEffect{\n    public active = true; // \u521B\u5EFA\u7684effect\u662F\u54CD\u5E94\u5F0F\u7684\n    // fn \u7528\u6237\u7F16\u5199\u7684\u51FD\u6570\n    // \u5982\u679Cfn\u4E2D\u4F9D\u8D56\u7684\u6570\u636E\u53D1\u751F\u53D8\u5316\u540E\uFF0C\u9700\u8981\u91CD\u65B0\u8C03\u7528 -> run()\n    constructor(public fn, public scheduler){\n\n    }\n    run(){\n        // \u8BA9fn\u6267\u884C\n        if(!this.active){\n            return this.fn();  // \u4E0D\u662F\u6FC0\u6D3B\u7684 \u6267\u884C\u540E \u4EC0\u4E48\u90FD\u4E0D\u505A\n        }\n        let lastEffect = activeEffect;\n        try{\n            activeEffect = this;\n            return this.fn(); // \u4F9D\u8D56\u6536\u96C6\n        }finally{\n            activeEffect = lastEffect;\n        }\n    }\n}", "export function isObject(value){\n    return typeof value === 'object' && value !== null\n}\n", "import { activeEffect } from \"./effect\";\n\nexport enum ReactiveFlags {\n    IS_REACTIVE = '__v_isReactive'\n}\n\n// proxy \u9700\u8981\u642D\u914D reflect \u4F7F\u7528\nexport const mutableHandlers: ProxyHandler<any> = {\n    get(target,key,recevier){\n        if(key === ReactiveFlags.IS_REACTIVE){\n            return true;\n        }\n\n        // \u53D6\u503C\u7684\u65F6\u5019 \u5E94\u8BE5\u8BA9 \u54CD\u5E94\u5F0F\u5C5E\u6027 \u548C effect \u6620\u5C04\u8D77\u6765\n        // \u4F9D\u8D56\u6536\u96C6\n        // console.log(activeEffect,key)\n        track(target,key); // \u6536\u96C6\u8FD9\u4E2A\u5BF9\u8C61\u4E0A\u7684\u8FD9\u4E2A\u5C5E\u6027 \u548Ceffect\u5173\u8054\u5728\u4E00\u8D77\n\n        return Reflect.get(target,key, recevier);\n    },\n\n    set(target,key,value,recevier){\n        // \u627E\u5230\u5C5E\u6027 \u8BA9\u5BF9\u5E94\u7684effect\u91CD\u65B0\u6267\u884C\n        // \u89E6\u53D1\u66F4\u65B0\n        return Reflect.set(target, key, value, recevier);\n    }\n}", "import { isObject } from \"@vue/shared\";\nimport { ReactiveFlags, mutableHandlers } from \"./baseHandler\";\n\n// \u7528\u4E8E\u8BB0\u5F55\u6211\u4EEC\u4EE3\u7406\u540E\u7684\u7ED3\u679C\uFF0C\u53EF\u4EE5\u590D\u7528\nconst reactiveMap = new WeakMap();  //weakMap\u9632\u6B62\u5185\u5B58\u6CC4\u6F0F\n\nfunction createReactiveObject(target){\n    // \u7EDF\u4E00\u5224\u65AD \u54CD\u5E94\u5F0F\u5BF9\u8C61\u5FC5\u987B\u662F\u5BF9\u8C61\n    if(!isObject(target)){\n        return target;\n    }\n\n    if(target[ReactiveFlags.IS_REACTIVE]){\n        return target;\n    }\n\n    // \u53D6\u7F13\u5B58 \u5982\u679C\u6709\u76F4\u63A5\u8FD4\u56DE\n    const existsProxy = reactiveMap.get(target);\n    if(existsProxy){\n        return existsProxy;\n    }\n\n    let proxy = new Proxy(target,mutableHandlers);\n\n    // \u6839\u636E\u5BF9\u8C61\u7F13\u5B58\u4EE3\u7406\u540E\u7684\u7ED3\u679C\n    reactiveMap.set(target,proxy)\n    return proxy;\n}\n\nexport function reactive(target){\n    return createReactiveObject(target)\n}"],
  "mappings": ";AAAO,SAAS,OAAO,IAAG,SAAS;AAI/B,QAAM,UAAU,IAAI,eAAe,IAAG,MAAI;AAEtC,YAAQ,IAAI;AAAA,EAChB,CAAC;AACD,UAAQ,IAAI;AAChB;AAEO,IAAI;AAEX,IAAM,iBAAN,MAAoB;AAAA;AAAA;AAAA;AAAA,EAIhB,YAAmB,IAAW,WAAU;AAArB;AAAW;AAH9B,SAAO,SAAS;AAAA,EAKhB;AAAA,EACA,MAAK;AAED,QAAG,CAAC,KAAK,QAAO;AACZ,aAAO,KAAK,GAAG;AAAA,IACnB;AACA,QAAI,aAAa;AACjB,QAAG;AACC,qBAAe;AACf,aAAO,KAAK,GAAG;AAAA,IACnB,UAAC;AACG,qBAAe;AAAA,IACnB;AAAA,EACJ;AACJ;;;ACjCO,SAAS,SAAS,OAAM;AAC3B,SAAO,OAAO,UAAU,YAAY,UAAU;AAClD;;;ACKO,IAAM,kBAAqC;AAAA,EAC9C,IAAI,QAAO,KAAI,UAAS;AACpB,QAAG,QAAQ,oCAA0B;AACjC,aAAO;AAAA,IACX;AAKA,UAAM,QAAO,GAAG;AAEhB,WAAO,QAAQ,IAAI,QAAO,KAAK,QAAQ;AAAA,EAC3C;AAAA,EAEA,IAAI,QAAO,KAAI,OAAM,UAAS;AAG1B,WAAO,QAAQ,IAAI,QAAQ,KAAK,OAAO,QAAQ;AAAA,EACnD;AACJ;;;ACtBA,IAAM,cAAc,oBAAI,QAAQ;AAEhC,SAAS,qBAAqB,QAAO;AAEjC,MAAG,CAAC,SAAS,MAAM,GAAE;AACjB,WAAO;AAAA,EACX;AAEA,MAAG,yCAAgC,GAAE;AACjC,WAAO;AAAA,EACX;AAGA,QAAM,cAAc,YAAY,IAAI,MAAM;AAC1C,MAAG,aAAY;AACX,WAAO;AAAA,EACX;AAEA,MAAI,QAAQ,IAAI,MAAM,QAAO,eAAe;AAG5C,cAAY,IAAI,QAAO,KAAK;AAC5B,SAAO;AACX;AAEO,SAAS,SAAS,QAAO;AAC5B,SAAO,qBAAqB,MAAM;AACtC;",
  "names": []
}
